<div class="space-y-6">
  <h1 class="<%= ui_title_class %>">Overview</h1>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Net Worth Section -->
    <div class="<%= ui_card_class %> p-6">
      <div class="mb-4">
        <%= link_to net_worth_path, class: "hover:text-cyan-600 dark:hover:text-cyan-400" do %>
          <h2 class="<%= ui_heading_class %> hover:text-cyan-600 dark:hover:text-cyan-400">Net Worth →</h2>
        <% end %>
        <p class="text-xs <%= ui_text_subtle_class %>"><%= @valuation_date.strftime("%B %Y") %></p>
      </div>

      <% total_value = @group_totals.values.sum %>
      <% if total_value > 0 %>
        <%
          group_data = @asset_groups.map do |group|
            value = @group_totals[group.id] || 0
            next nil if value == 0
            pct = (value.to_f / total_value * 100).round(1)
            { name: group.name, value: value, pct: pct, color: group.color || '#94a3b8' }
          end.compact
        %>

        <div class="flex items-center justify-between mb-6">
          <div>
            <p class="text-3xl font-bold <%= ui_text_class %>"><%= format_currency(@net_worth[:net_worth], precision: 0) %></p>
            <p class="text-sm <%= @net_worth_change >= 0 ? ui_positive_class : ui_negative_class %>">
              <%= @net_worth_change >= 0 ? '+' : '' %><%= format_currency(@net_worth_change, precision: 0) %> from last month
            </p>
          </div>

          <!-- Donut Chart -->
          <% if group_data.any? %>
            <svg width="100" height="100" viewBox="0 0 42 42" class="flex-shrink-0">
              <circle cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#f1f5f9" stroke-width="8" class="dark:stroke-slate-700"></circle>
              <%
                cumulative = 0
                group_data.each do |group|
                  dash = group[:pct]
                  gap = 100 - dash
                  offset = 25 - cumulative
              %>
                <circle cx="21" cy="21" r="15.91549430918954" fill="transparent"
                        stroke="<%= group[:color] %>" stroke-width="8"
                        stroke-dasharray="<%= dash %> <%= gap %>"
                        stroke-dashoffset="<%= offset %>"></circle>
              <% cumulative += dash; end %>
            </svg>
          <% end %>
        </div>

        <!-- Legend -->
        <div class="space-y-1">
          <% group_data.each do |group| %>
            <div class="flex items-center justify-between text-sm">
              <div class="flex items-center">
                <svg class="flex-shrink-0 mr-2" width="12" height="12"><rect width="12" height="12" fill="<%= group[:color] %>"/></svg>
                <span class="<%= ui_text_muted_class %>"><%= group[:name] %></span>
              </div>
              <div class="flex items-center gap-3">
                <span class="<%= ui_text_class %> font-medium"><%= format_currency(group[:value], precision: 0) %></span>
                <span class="<%= ui_text_subtle_class %> w-12 text-right"><%= group[:pct] %>%</span>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="<%= ui_text_muted_class %>">No asset valuations yet.</p>
      <% end %>
    </div>

    <!-- Cash Flow Section -->
    <div class="<%= ui_card_class %> p-6">
      <div class="mb-4">
        <%= link_to cash_flow_path, class: "hover:text-cyan-600 dark:hover:text-cyan-400" do %>
          <h2 class="<%= ui_heading_class %> hover:text-cyan-600 dark:hover:text-cyan-400">Cash Flow →</h2>
        <% end %>
        <p class="text-xs <%= ui_text_subtle_class %>">Last 3 months</p>
      </div>

      <% if @monthly_cash_flow.any? %>
        <div class="space-y-4">
          <% @monthly_cash_flow.each do |month| %>
            <div class="border-b border-slate-100 dark:border-slate-700 pb-3 last:border-0 last:pb-0">
              <div class="font-medium <%= ui_text_class %> mb-2"><%= month[:month_name] %></div>
              <% total = [month[:income], month[:expenses]].max %>
              <% if total > 0 %>
                <% expense_pct = (month[:expenses].to_f / [month[:income], 1].max * 100).round(1) %>
                <% expense_pct = [expense_pct, 100].min %>
                <% saved_pct = [100 - expense_pct, 0].max %>
                <div style="height: 24px; display: flex;" class="overflow-hidden text-xs rounded">
                  <div style="width: <%= expense_pct %>%;" class="bg-rose-200 dark:bg-rose-900/50 h-full flex items-center justify-start pl-2">
                    <% if expense_pct > 20 %><span class="text-rose-700 dark:text-rose-300">Expenses <%= expense_pct.round(0) %>%</span><% end %>
                  </div>
                  <div style="width: <%= saved_pct %>%;" class="bg-emerald-200 dark:bg-emerald-900/50 h-full flex items-center justify-end pr-2">
                    <% if saved_pct > 20 %><span class="text-emerald-700 dark:text-emerald-300">Saved <%= saved_pct.round(0) %>%</span><% end %>
                  </div>
                </div>
              <% end %>
              <div class="flex justify-between text-sm mt-2">
                <span class="<%= ui_positive_class %>">+<%= format_currency(month[:income], precision: 0) %></span>
                <span class="<%= ui_negative_class %>">-<%= format_currency(month[:expenses], precision: 0) %></span>
                <span class="font-medium <%= month[:net] >= 0 ? ui_text_class : ui_negative_class %>">
                  = <%= format_currency(month[:net], precision: 0) %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="<%= ui_text_muted_class %>">No transactions yet.</p>
      <% end %>
    </div>
  </div>
</div>
