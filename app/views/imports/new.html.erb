<% content_for :title, "Import Transactions" %>

<div>
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-slate-800 mb-2">Import Transactions</h1>
      <p class="text-slate-600">Upload a PDF or CSV bank statement to automatically extract transactions.</p>
    </div>
    <%= link_to "Import History", imports_path, class: "rounded-lg px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium transition" %>
  </div>

  <%= form_with url: imports_path, method: :post, multipart: true, class: "space-y-6" do |form| %>
    <div class="bg-white rounded-xl border border-slate-200 p-6">
      <div class="mb-6">
        <%= form.label :account_id, "Target Account", class: "block text-sm font-medium text-slate-700 mb-1" %>
        <p class="text-sm text-slate-500 mb-2">All imported transactions will be added to this account.</p>
        <%= form.collection_select :account_id, @accounts, :id, :name, 
            { prompt: "Select account" }, 
            class: "block w-full rounded-lg border-slate-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 border px-3 py-2",
            required: true %>
      </div>

      <div>
        <%= form.label :file, "Bank Statement File", class: "block text-sm font-medium text-slate-700 mb-1" %>
        <p class="text-sm text-slate-500 mb-2">PDF or CSV file (max 5MB)</p>
        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 border-dashed rounded-lg hover:border-cyan-400 transition">
          <div class="space-y-1 text-center">
            <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="flex text-sm text-slate-600">
              <%= form.file_field :file, 
                  accept: ".pdf,.csv,application/pdf,text/csv",
                  class: "sr-only",
                  id: "file-upload",
                  required: true %>
              <label for="file-upload" class="relative cursor-pointer rounded-md font-medium text-cyan-600 hover:text-cyan-500 focus-within:outline-none">
                <span>Upload a file</span>
              </label>
              <p class="pl-1">or drag and drop</p>
            </div>
            <p class="text-xs text-slate-500">PDF or CSV up to 5MB</p>
          </div>
        </div>
        <p class="mt-2 text-sm text-slate-500" id="file-name"></p>
      </div>
    </div>

    <div class="flex items-center space-x-4">
      <%= form.submit "Extract Transactions", class: "rounded-lg px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white font-medium cursor-pointer transition" %>
      <%= link_to "Cancel", transactions_path, class: "rounded-lg px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium transition" %>
    </div>
  <% end %>

  <div class="mt-8 bg-slate-50 rounded-xl border border-slate-200 p-6">
    <h2 class="font-semibold text-slate-700 mb-2">How it works</h2>
    <ol class="list-decimal ml-5 text-sm text-slate-600 space-y-1">
      <li>Upload your bank statement (PDF or CSV format)</li>
      <li>Our AI extracts transactions and matches them to categories</li>
      <li>Review the extracted transactions and make any adjustments</li>
      <li>Select which transactions to import and click Import</li>
    </ol>
    <p class="mt-4 text-sm text-slate-500">
      <strong>Note:</strong> Duplicate transactions (same date, amount, and description) will be detected and marked.
    </p>
  </div>
</div>

<script>
  document.getElementById('file-upload').addEventListener('change', function(e) {
    const fileName = e.target.files[0]?.name;
    document.getElementById('file-name').textContent = fileName ? `Selected: ${fileName}` : '';
  });
</script>
