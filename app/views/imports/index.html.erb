<% content_for :title, "Imports" %>

<div class="w-full">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-slate-800">Imports</h1>
    <%= link_to "New Import", new_import_path, class: "rounded-lg px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white font-medium transition" %>
  </div>

  <!-- Year Navigation -->
  <div class="bg-white rounded-xl border border-slate-200 mb-4 px-4 py-2">
    <div class="flex items-center justify-between">
      <% prev_year = @current_year - 1 %>
      <% if @available_years.include?(prev_year) %>
        <%= link_to imports_path(year: prev_year), class: "p-1 hover:bg-slate-50 rounded-lg transition text-slate-500 text-sm" do %>
          &larr; <%= prev_year %>
        <% end %>
      <% else %>
        <span class="p-1 text-transparent text-sm">&larr; <%= prev_year %></span>
      <% end %>

      <span class="font-semibold text-slate-700"><%= @current_year %></span>

      <% next_year = @current_year + 1 %>
      <% if @available_years.include?(next_year) %>
        <%= link_to imports_path(year: next_year), class: "p-1 hover:bg-slate-50 rounded-lg transition text-slate-500 text-sm" do %>
          <%= next_year %> &rarr;
        <% end %>
      <% else %>
        <span class="p-1 text-transparent text-sm"><%= next_year %> &rarr;</span>
      <% end %>
    </div>
  </div>

  <% if @sorted_months.any? || @has_ungrouped %>
    <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
      <table class="min-w-full">
        <thead class="bg-slate-50 border-b border-slate-200">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">File</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Account</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Transactions</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Imported</th>
            <th class="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider w-24"></th>
          </tr>
        </thead>
        <tbody class="bg-white">
          <%# Render each month group %>
          <% @sorted_months.each do |month| %>
            <% month_imports = @imports_by_month[month] %>
            <tr class="bg-slate-50 border-t border-b border-slate-200">
              <td colspan="6" class="px-4 py-1.5 text-xs font-medium text-slate-500">
                <%= month.strftime("%B") %>
                <span class="text-slate-400 ml-2"><%= month_imports.size %> import<%= month_imports.size == 1 ? '' : 's' %></span>
              </td>
            </tr>
            <% month_imports.each do |import| %>
              <%= render partial: "imports/import_row", locals: { import: import } %>
            <% end %>
          <% end %>

          <%# Render ungrouped imports (pending, failed, or no transactions) %>
          <% if @has_ungrouped %>
            <% ungrouped_imports = @imports_by_month[nil] %>
            <tr class="bg-slate-50 border-t border-b border-slate-200">
              <td colspan="6" class="px-4 py-1.5 text-xs font-medium text-slate-500">
                <% if @sorted_months.any? %>
                  Other
                <% else %>
                  Recent
                <% end %>
                <span class="text-slate-400 ml-2"><%= ungrouped_imports.size %> import<%= ungrouped_imports.size == 1 ? '' : 's' %></span>
              </td>
            </tr>
            <% ungrouped_imports.each do |import| %>
              <%= render partial: "imports/import_row", locals: { import: import } %>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="bg-white rounded-xl border border-slate-200 p-6 text-center">
      <p class="text-slate-500 mb-4">No imports for <%= @current_year %>.</p>
      <%= link_to "Upload a statement", new_import_path, class: "text-cyan-600 hover:underline" %>
    </div>
  <% end %>
</div>
