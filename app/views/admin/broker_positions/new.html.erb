<% content_for :title, "Add Position - #{@connection.name}" %>

<% content_for :breadcrumbs do %>
  <%= ui_breadcrumbs do %>
    <%= ui_breadcrumb_first "Settings" %>
    <%= ui_breadcrumb_item "Brokers", admin_broker_connections_path %>
    <%= ui_breadcrumb_item @connection.name, admin_broker_connection_path(@connection) %>
  <% end %>
<% end %>

<div class="w-full">
  <h1 class="<%= ui_title_class %> mb-6">Add Position</h1>

  <%= form_with model: [:admin, @connection, @position], url: admin_broker_connection_positions_path(@connection), class: "contents" do |form| %>
    <% if @position.errors.any? %>
      <div class="<%= ui_alert_error_class %> mb-4">
        <h2 class="font-medium"><%= pluralize(@position.errors.count, "error") %> prohibited this position from being saved:</h2>
        <ul class="list-disc ml-6 mt-2">
          <% @position.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="mb-4">
      <%= form.label :symbol, "Symbol", class: ui_label_class %>
      <%= form.text_field :symbol, class: ui_input_class, placeholder: "BTC", autofocus: true %>
      <p class="text-sm <%= ui_text_muted_class %> mt-1">
        Supported crypto: <%= BrokerPosition::COINGECKO_SYMBOL_MAP.keys.join(", ") %>
      </p>
    </div>

    <div class="mb-4">
      <%= form.label :description, class: ui_label_class %>
      <%= form.text_field :description, class: ui_input_class, placeholder: "Bitcoin" %>
    </div>

    <div class="mb-4">
      <%= form.label :last_quantity, "Quantity", class: ui_label_class %>
      <%= form.number_field :last_quantity, step: "any", class: ui_input_class, placeholder: "0.15" %>
    </div>

    <div class="mb-4">
      <%= form.label :currency, class: ui_label_class %>
      <%= form.select :currency, ["USD"], {}, class: ui_input_class, disabled: true %>
      <%= form.hidden_field :currency, value: "USD" %>
      <p class="text-sm <%= ui_text_muted_class %> mt-1">
        Crypto positions are valued in USD via CoinGecko.
      </p>
    </div>

    <div class="flex space-x-4">
      <%= form.submit "Create Position", class: ui_btn_primary_class + " cursor-pointer" %>
      <%= link_to "Cancel", admin_broker_connection_path(@connection), class: ui_btn_secondary_class %>
    </div>
  <% end %>
</div>
